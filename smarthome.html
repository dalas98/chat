<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=1920, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Smart Home Hans</title>
</head>
<body>
    <div class="dashboard">
        <header>
            <div class="f fe">
            <div class="icon icon-w"></div>
            <div class="heading">
                <h5 class="date"></h5>
                <h2 class="title">Cloudy</h2>
            </div>
            </div>
            
            <div class="weather f">
            <div>
                <strong>26Â°<sup>C</sup></strong>
                <p>Indoor Temp.</p>
            </div>
            <div>
                <strong>48.2%</strong>
                <p>Outdoor Humidity</p>
            </div>
            <div>
                <strong>52.99</strong>
                <p>Indoor Temp.</p>
            </div>
            </div>
        </header>
        <section>
            <!-- Category -->
            <div class="category">
                <ul>
                    <li><a href="#!" class="active">All</a></li>
                    <li><a href="#!">Living Room</a></li>
                    <li><a href="#!">Kitchen</a></li>
                    <li><a href="#!">Dinning</a></li>
                    <li><a href="#!">Weather</a></li>
                </ul>
            </div>

            <!-- Appliances -->
            <div class="appliances">
            
                <!-- <div class="appliance">
                    <input type="checkbox" name="a" id="a">
                    <label for="a">
                        <i class="l"></i>
                        <strong>Lampu Luar</strong>
                        <span data-o="opened" data-c="closed"></span>
                        <small></small>
                    </label>
                </div>
                
                <div class="appliance">
                    <input type="checkbox" name="a" id="b">
                    <label for="b">
                        <i class="r"></i>
                        <strong>Lampu Depan</strong>
                        <span data-o="opened" data-c="closed"></span>
                        <small></small>
                    </label>
                </div>
                
                <div class="appliance">
                    <input type="checkbox" name="a" id="c">
                    <label for="c">
                        <i class="a"></i>
                        <strong>Lampu Kamar</strong>
                        <span data-o="opened" data-c="closed"></span>
                        <small></small>
                    </label>
                </div>
                
                <div class="appliance">
                    <input type="checkbox" name="a" id="d">
                    <label for="d">
                        <i class="f"></i>
                        <strong>Lampu Dapur</strong>
                        <span data-o="opened" data-c="closed"></span>
                        <small></small>
                    </label>
                </div> -->
            
                <!-- <div class="m-player">
                    <h2>Shared Devices</h2>
                    <div class="player">
                        <div class="disc"></div>
                        <div class="artist">
                            <p>Rosetta Stoned</p>
                            <small>Tool</small>
                        </div>
                        <div class="controls">
                            <input type="checkbox" name="a" id="p">
                            <label for="p">
                                <div class="control"></div>
                            </label>
                        </div>
                    </div>
                </div> -->
            </div>
        </section>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- <script src="https://socket-hans.herokuapp.com/socket.io/socket.io.js"></script> -->
<script src="http://localhost:6969/socket.io/socket.io.js"></script>

<script>
    // var socket = io("wss://socket-hans.herokuapp.com");
    var socket = io("ws://localhost:6969/");
    socket.on("chat", function(msg) {
        console.log("message get", msg)
    });
    var params = null

    $.ajax({
        url: "http://localhost:6969/device",
        success: (res) => {
            for (let i = 0; i < res.data.length; i++) {
                const data = res.data[i];
                const id = data.id
                let check = data.state ? "" : "checked"
                const checkbox = `<input type=\"checkbox\" name=\"${id}\" id=\"${id}\" ${check}>`
                let htmlTemplate = `<div class=\"appliance\"> ${checkbox}
                    <label for=\"${id}\">\
                        <i class=\"l\"></i>\
                        <strong>${data.name}</strong>\
                        <span data-o=\"opened\" data-c=\"closed\"></span>\
                        <small></small>\
                    </label>\
                </div>`
                $(".appliances").append(htmlTemplate)
                $("#"+id).click(function(){
                    if($(this).is(":checked")){
                        params = { id: Number(id), port: Number(data.pin), state: true }
                    }else{
                        params = { id: Number(id), port: Number(data.pin), state: false }
                    }
                    socket.emit("relay", params);
                });
            }
            socket.on("relay", (event) => {
                $("#"+event.id).prop("checked", event.state)
            })
        }
    })

    let dateNow = new Date().toLocaleString('id', { weekday:"long", month: "long", day: "2-digit", year:"numeric" })
    $(".date").html(dateNow)
</script>
</html>